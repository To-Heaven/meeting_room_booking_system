# 需求与功能分析

## 需求
- 设计一个预订会议室的系统

#### 需求分析
- 从预订会议室的业务流程来分析需求
    1. 首先，肯定是用户登录 ，一个用户只有在登录之后才能进行会议室之后的操作
    2. 然后，预订会议室页面，预订一个会议室除了要提供会议室的名称、预订的日期之外还要有时间段，比如8：00～9：00
    3. 用户登录之后还需要显示会议室的预订情况，比如张三预订了某个会议室，那么就需要在页面中显示出张三以及其预订的会议室及详细信息，因此我们应该使用表格来显示会议室的预订情况，表格的横轴用来显示固定的时间段，纵轴用来显示会议室的名称。
        - 之所以将时间段放在横轴，这是考虑到其不变性，对于时间段来说，一般是不变的，而公司的会议室则是不固定的。如果将会议室名称放在横轴，那么当回意识越来越多的时候，页面上就需要使用滚动条来左右移动查看预订情况，显然是不符合阅读习惯的
    4. 用户除了可以新创建一个预订之外，还可以撤销之前的预订，这个功能在实际中也经常遇到
    

## 功能
#### 功能分析
- 登录验证
    - 页面： 使用Django的form组件来实现用户的登录以及后端验证的过程，前端发送请求应该使用Ajax，这样用户登录信息在后端验证失败时，我们可以将错误信息返回，并交由前端ajax中的回调函数来渲染错误信息
    - 验证：验证包含三个部分
        - 在视图函数中包含两个验证，
            1. 使用form组件对用户提交的数据信息的规范性进行验证
            2. 将用户提交的数据作为查询条件，去数据库中匹配，如果能够匹配到一条记录，说明用户名和密码正确
        - 中间件session验证
            1. 用户登录成功之后，会将用户的相关信息保存在session中，如果用户没有登录，我们可以让没有登录的用户跳转到登录页面
    - 保存用户登录信息
        - 如果用户想要在一段时间内每次访问页面的时候都不需要再次登录，那么我们可以在页面上提供一个`checkbox`供用户选择，如果用户向下次直接进入页面，那么就勾选该`checkbox`，后端需要做的就是设置用户的session有效时间

- 预订界面
    - 渲染页面
        - 渲染页面有两种方法，一种是直接使用Django提供的模板渲染，另一种是在页面加载完成之后，前端发送Ajax请求，后端返回便于生成数据和实现功能的数据结构，然后在Ajax的回调函数中渲染页面，在本项目中，采用的是模板渲染
            - 注意，不论是使用模板渲染还是使用ajax前端渲染，都需要在后端设计好一种数据结构，详情在后面会介绍
    - 日历插件
        - 日历插件选择BootStrap提供的日历插件
        - 当用户点击日历上的一天时，根据input标签的onchange事件配合form标签对象的submit()方法来刷新页面
            - 细节
                1. 用户不能预订的日期不能是已经过去的日期，这个需要在后端进行一次判断，这类判断不要放在前端，因为前端提交的数据是可以被修改的，作为Web开发人员，我们应该将前端提交的数据看作是不安全的。
     - 用户新建预订与撤销预订
        - 用户在前端新创建的预订与用户的点击事件绑定，当用户点击一个单元格的时候，存在三种情况
            1. 当前单元格对应的预订已经被预订
                - 后端判断，该预订记录关联的用户是不是当前用户
                    - 如果是当前用户，就会撤销该预订
                    - 如果是其他用户，就会返回撤销失败的信息
            3. 当前单元格对应的时间段尚未被预订
                - 绑定点击事件，标记该单元格
    - 提交数据
        - 提交数据时，需要将前端数据处理成一种方便后端读取的数据结构，要能够保证实现以下功能
            1. 能够区分不同的会议室和时间段，比如对于同一个时间段8：00～9：00来说，要对不同会议室的预订分开
            2. 提供预订日期
            
        
      
        
        
        

